<!DOCTYPE html>
<!--
CHAPTER 14
-->
<html>
    <head>
        <title>Event Handling&#0153</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <h1>Chapter 14: Event Handling</h1>
        <p>
            click this document to activate the handler
        </p>
        <button>Click Me</button>
        <p>No handler here</p>
        
        <br><br>
        <button id="act">Act-once Button</button>
        <br><br>
        
        
        <!--EVENT OBJECTS-->
        <h2>Event Objects</h2>                                                  
        <button id="eventObject1">
            Click Me Any Way You Want
        </button>
        <br><br>
        
        <!--PROPAGATION-->
        <h2>Propagation</h2>
        <p id="prg">
            A paragraph with a 
            <button id="prgButton">
                Button
            </button>
        </p>
        <br>
        
        
        <button>A</button>
        <button>B</button>
        <button>C</button>
        <br><br>
        
        <!--DEFAULT ACTIONS-->
        <h2>Default Actions</h2>
        <a href="https://developer.mozilla.org/">MDN</a>                        
        <br><br>
        
        <!--KEY EVENTS-->
        <h2>Key Events</h2>
        <p id="vKey">
            This page turns violet when you hold the V key.
        </p>
        <br><br>
        
        <!--Continued-->
        <p>Press Control-Space to continue.</p>
        <br><br>
        
        <!--MOUSE MOTION-->
        <h2>Mouse Motion</h2>
        <p>
            Drag the bar to change its width.
        </p>
        <div style="background: orange; width: 60px; height: 20px" id="bar">
            
        </div>
        <br><br>
        
        <!--TOUCH EVENTS-->
        <h2>Touch Events</h2>
        <P>Touch this page</p>
        <br><br>
        
        <!--SCROLL EVENTS-->
        <h2>Scroll Events</h2>
        <div id="progress"></div>
        <br><br>
        
        <!--FOCUS EVENTS-->
        <h2>Focus Event</h2>
        <p>Name: <input type="text" data-help="Your full name"></p>
        <p>Age: <input type="text" data-help="Your age in years"></p>
        <p id="help"></p>
        <br><br>
        
        <!--DEBOUNCING-->
        <h2>Debouncing</h2>
        <textarea>Type something here....</textarea><br>
        <br><br>
        
        <h2 id="mouse">waiting for mouse movement...</h2>
        
        <!--THE SCRIPT BEGINS-->
        <script>
            /*window.addEventListener("click", () => {  */                      //listen for a click on the window, if there is a click run this 
            //    console.log("You Knocked");
            //});
           
            /* Button Click Me */
            let button = document.querySelector("button");                      //binding the button element with variable button
            button.addEventListener("click", () => {                            //listening for a click, second argument is for the function that you want executed when a button click is heard 
               console.log("Button Clicked");                                   //command to be executed when the click is heard
            });
           
            /*Act-once Button*/
            let button2 = document.querySelector("#act");                       //binding the button element with a variable
            function once(){                                                    //function that removes the event listener
                console.log("done");                                            //loging done when the listener is removed
                button2.removeEventListener("click", once);                     //removing the listener
            }
            button2.addEventListener("click", once);                            //the initial state: this listener is removed upon executionof function "once"
            
            /*Event Objects*/
            let button3 = document.querySelector("#eventObject1");              //binding the element and the variable
            button3.addEventListener("mousedown", event => {                    //listing for mouse button presses, and the second argument is a function executed upon mouse button press
                if(event.button == 0){                                          //if the value = 0 ("false" works too)..
                    console.log("Left Button");                                 //that must be the left button
                }
                else if(event.button == 1){                                     //if the value is 1(i guess "true" works too)..
                    console.log("Middle Button");                               //that must be the middle button
                }
                else if(event.button == 2){                                     //if the value is 2..
                    console.log("Right Button");                                //that must be the right button
                }
            });
            
            /*Propagation*/                         
            let para = document.querySelector("#prg");                          //selecting an id of an element, and...
            let button4 = document.querySelector("#prgButton");                 //binding the said element to a variable
            para.addEventListener("mousedown", () => {                          //listening for a mousedown on the paragraph(click)
                console.log("Handler for Paragraph");
            });
            button4.addEventListener("mousedown", event => {                    //listening for a click on the button
                console.log("Handler for Button");
                if(event.button == 2) event.stopPropagation();                  //if its a right click, dont log "Handler for Paragraph"
            });
            
            /* Event listener to anything that is a button */
            document.body.addEventListener("click", event => {                  //listens to any element..
                if(event.target.nodeName == "BUTTON"){                          //that is a button
                    console.log("Clicked", event.target.textContent);           //this is what it logs on the console every time a button, any button, is pressed
                }
            });
            
            /*Default Actions*/
            let link = document.querySelector("a");                             //binding link to variable 'link'
            link.addEventListener("click", event => {                           //this eventlistener prevents the default action of a link
                console.log("Nope.");
                event.preventDefault();                                         //line that prevents ddefault action, it can also be used in a switch block.
            });
            
            /*Key Events*/
            window.addEventListener("keydown", event => {                       //listens for a key down...
                if(event.key == "v"){                                           //when "v" is pressed..
                    document.body.style.background = "violet";                  //change the background to violet
                    document.body.style.color = "black";                        //and the fonts to black
                }
            });
            window.addEventListener("keyup", event => {
                if(event.key === "v"){                                          //even without this it works, but i strongly feel we should keep it.
                    document.body.style.background = "#731212";
                    document.body.style.color = "white";
                }
            });
            
            /*Handling Multiple Key Inputs*/
            window.addEventListener("keydown", event => {                       
                if(event.ctrlKey){                                              //first listen for the ctrl key..
                    if(event.key === " ") console.log("Continuing");            //then listen for space..then log continuing
                }                                                               //nearly gave up on this spell
            });
            
            /*Pointer Events*/
            window.addEventListener("click", event => {                         //this event handler creates a dot directly under a mouse click anywhere in the screen.
                let dot = document.createElement("div");                        //creating an element div.
                dot.className = "dot";                                          //class name of the said div.
                dot.style.left = (event.pageX - 4) + "px";                      //setting the X position.
                dot.style.top = (event.pageY - 4) + "px";                       //setting the Y position.
                document.body.appendChild(dot);                                 //basically I understand this as => </div>
                console.log("Dot");                                             //loging this t o the console everytime a dot is creasted on screen.
            });
            
            /*Mouse Motion*/
            let lastX;
            let bar = document.querySelector("#bar");                           //selecting and element with id = "bar"
            bar.addEventListener("mousedown", event => {                        //event hander that resizes the bar.
                if(event.button == 0){                                          //if the left mouse button is pressed..
                    lastX = event.clientX;                                      //set lastX position to the clientX value(more accurate as it counts in being scrolled)..
                    window.addEventListener("mousemove", moved);                //handle the mouse move by calling the moved function.
                    event.preventDefault();                                     //prevents selection.
                }
            });
            
            function moved(event){                                              //function moved.
                if(event.buttons == 0){                                         //stop resizing the bar when the mouse button is released(check hand notes).
                    window.removeEventListener("mousemove", moved);             //remove the listener when the left mouse button is released.
                }
                else{
                    let dist = event.clientX - lastX;
                    let newWidth = Math.max(10, bar.offsetWidth + dist);        //if offsetWidth + dist > 10, then the new width = bar.offsetWidth + dist.
                    bar.style.width = newWidth + "px";                          //set the width of the bar to newWidth.
                    lastX = event.clientX;                                      //set lastX to clientX, which counts in scrolls.
                }
            }
            
            /*Touch Events*/
            function update(event){                                             //function update, writes and removes, a red ring around a touched point on the screen
                for(let dot; dot = document.querySelector("dot");){             //this works lie clearRect: it..
                    dot.remove();                                               //it removes red ring around the finger once the finger is lifted off the screen
                }
                for(let i = 0; i < event.touches.length; i++){                  //for loop that creates red ring around any point that is touched by a finger on the touch screen
                    let {pageX, pageY} = event.touches[i];                      //touches is an array that stores cordinates of a point that is touched by a finger
                    let dot = document.createElement("dot");                    //creating a dot element, a ring actually, this is going to be removed by the for loop above.
                    dot.style.left = (pageX - 50) + "px";                       //setting the width
                    dot.style.top = (pageY - 50) + "px";                        //setting th height
                    document.body.appendChild(dot);                             //closing the dot element
                }
            }
            window.addEventListener("touchstart", update);                      //event handler that calls function update upon the screen being touched.
            window.addEventListener("touchmove", update);                       //event handler that calls function update when the finger is dragged around the screen.
            window.addEventListener("touchend", update);                        //event handler that calls function update when the finger is lifted from the screen.
            
            /*Scroll Events*/
            document.body.appendChild(document.createTextNode(
                    `supercalifragilisticexpiallidocious\n`.repeat(5)));        //creating content
            
            let pBar = document.querySelector("#progress");                     //binding variable pBar to the pregress bar div.
            window.addEventListener("scroll", () => {                           //event handler listening for a scroll.
                let max = document.body.scrollHeight - innerHeight;             //this is used to calculate the width of the progress bar.
                pBar.style.width = `${(pageYOffset / max) * 100}%`;             //calculating the width of the progress bar.
            });
            
            /*Focus Events*/
            let help = document.querySelector("#help");                         //binding variable to element id: equivalent to document.getElementById("help")
            let fields = document.querySelectorAll("input");                    //binding all inputs to variable fields
            for(let field of Array.from(fields)){                               //querySelector all stores the bindings in an arrayish data structure, hence Array.from() spell.
                field.addEventListener("focus", event => {                      //event Handler listens for the element to be in focus.
                    let text = event.target.getAttribute("data-help");          //getting the attribute of the made up thing "data-help".
                    help.textContent = text;                                    //writing to the paragraph element with help as its 'id'
                });
                field.addEventListener("blur", event => {                       //event handler that listens for out of focus i.e blur
                    help.textContent = "";                                      //removing whatever is written on the help 'id' paragraph element
                });
            }
            
            /*Events and the Event Loop*/
            let squareWorker = new Worker("workers/squareworker.js");           //introduction to class Worker, squareworker.js is a file that does one thing only, calulates the square of whatever no. it is fed
            squareWorker.addEventListener("message", event => {                 //event handler that that displays what the worker has worked, has calculated
                console.log("The worker responded: ", event.data);              //event.data: is the data thats gonna come from worker js file
            });
            squareWorker.postMessage(10);                                       //calling the squareworker to calculate the square of 10: 100
            squareWorker.postMessage(24);                                       //calling the worker to work on squaring 24: 
            
            /*Timers*/
            let bombTimer = setTimeout(() => {                                  //setTimeout and setInterval spells of the same type
                console.log("BOOM");                                            //print Boom..
            }, 1000);                                                           //after a 1000 milliseconds
            
            if(Math.random() < 0.5){                                            //if the random number is less than 0.5, which 50% of the time...
                console.log("Bomb Defused");                                    //print bomb defused..
                clearTimeout(bombTimer);                                        //and clearTimeout--which is the same spell as clearInterval
            }
            
            /*Another Timer*/
            let ticks = 0;                                                      //declaring variable ticks, equating it to 0
            let clock = setInterval(() => {                                     //setInterval and setTimeout similar spells
                console.log("tick", ticks++);                                   //log tick and the value of ticks, increament ticks as you go along
                if(ticks === 60){                                               //if ticks = 60...
                    clearInterval(clock);                                       //clearInterval which is the same as clearTimeout
                    console.log("stop");                                        //print stop
                }
            }, 1000);                                                           //increment the ticks every 1000 milliseconds
            
            /*Debouncing*/                                                      
            let textarea = document.querySelector("textarea");                  //binding variable textarea to element textarea
            let timeout;                                                        //declaring variable timeout
            textarea.addEventListener("input", () => {                          //adding event handle to textarea, the event handler is going to fire on input
                clearTimeout(timeout);                                          //clearing the timeout varieble,this is done so that if it had some value in it, that value is cleared
                timeout = setTimeout(() => console.log("Typed"), 500);          //the handle prints "typed" after 500ms have elapsed since the input event was fired
            });
            
            /*Slightly different debounce*/
            let scheduled = null;                                               //declaring variable scheduled
            let mouse = document.querySelector("#mouse");                       //this is my take i didnt want to replace the whole document with the mouse coordinates
            window.addEventListener("mousemove", event => {                     //adding an event handler to the entire window, the event will be fired on mouse move
                if(!scheduled){                                                 //if scheduled is null
                    setTimeout(() => {
                        mouse.textContent = 
                            `Mouse at:  ${scheduled.pageX}, 
                                        ${scheduled.pageY}`;                    //replace the contents of the paragraph with id = "mouse" with the cordinates of the mouse
                        scheduled = null;                                       //set scheduled to null again, the code works without this idk what it is for at the moment
                    }, 250);
                }
                scheduled = event;
            });
        </script>
    </body>
</html>
